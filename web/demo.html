<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>hypnotic: Let JavaScript Sleep</title>
    <script src="../deps/streamlinejs/lib/callbacks/require-stub.js"></script>
    <script src="../deps/narcissus/lib/jsdefs.js"></script>
    <script src="../deps/narcissus/lib/jslex.js"></script>
    <script src="../deps/narcissus/lib/jsparse.js"></script>
    <script src="../deps/narcissus/lib/jsdecomp.js"></script>
    <script src="../deps/streamlinejs/lib/version.js"></script>
    <script src="../deps/streamlinejs/lib/util/source-map.js"></script>
    <script src="../deps/streamlinejs/lib/callbacks/format.js"></script>
    <script src="../deps/streamlinejs/lib/callbacks/transform.js"></script>
    <script src="../deps/streamlinejs/lib/util/future.js"></script>
    <script src="../deps/streamlinejs/lib/callbacks/runtime.js"></script>
    <script src="../deps/streamlinejs/lib/callbacks/builtins.js"></script>
    <script src="../lib/hypnotic.min.js"></script>
    <script src="demo.js"></script>
    <style>
    </style>
  </head>
  <body>
  <textarea id="source" autocomplete="off" rows="30" cols="50">
// Collect mouse events
var events = [];
document.addEventListener('mousemove', function(e) {
    events.push(e);
});

// Wait for mouse movement SYNCHRONOUSLY
function wait_for_mousemove(timeout) {
    events.length = 0;
    var threshold = Date.now() + timeout;
    while(events.length == 0) {
        if((timeout > 0) && (Date.now() >= threshold))
            return false;

        sleep(10); // does it work?
    }
    return true;
}


// helpers
var output_e = document.getElementById('output');
var print = function(msg) {
    output_e.textContent = msg;
};


// a bunch of blank lines






/*
 * Does sleep() work in JavaScript?
 * Yes with hypnotic!
 */
(function(){
    print('How fast can you react?');
    sleep(1500);

    print('Let\'s see...');
    sleep(1500);

    print('Hold your mouse...');
    var timeout = 1000 + 2000 * Math.random(); 
    if(wait_for_mousemove(timeout)) {
        print('Too soon!');
        return;
    }

    print('Wait for it...');
    var timeout = 2000 + 1000 * Math.random(); 
    if(wait_for_mousemove(timeout)) {
        print('Too soon!');
        return;
    }

    print('Move it now!');
    var t = Date.now();
    wait_for_mousemove(0);
    print('Time: ' + (Date.now() - t) + 'ms');
})();
  </textarea>
  <button type="button" id="execute">Execute!</button>
  <div id="output"></div>
  </body>
</html>
